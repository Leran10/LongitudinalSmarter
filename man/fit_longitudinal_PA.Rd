% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_PA.R
\name{fit_longitudinal_PA}
\alias{fit_longitudinal_PA}
\title{Fit longitudinal presence/absence models with comprehensive contrasts}
\usage{
fit_longitudinal_PA(
  PA_matrix,
  metadata,
  dx_var,
  timepoint_var,
  covariates = NULL,
  random_var = NULL,
  baseline_level = "t0",
  ref_level = "CONTROL",
  non_ref_level = "CELIAC",
  adjust_method = "BH",
  return_models = FALSE,
  verbose = TRUE
)
}
\arguments{
\item{PA_matrix}{Matrix or data.frame of presence/absence data (features x samples).
Rownames should be feature IDs, colnames should be sample IDs.}

\item{metadata}{Data frame with sample metadata. Rownames should match colnames of PA_matrix.}

\item{dx_var}{Name of diagnosis/group variable in metadata (e.g., "Dx.Status")}

\item{timepoint_var}{Name of timepoint variable in metadata (e.g., "onset_timeline_combined")}

\item{covariates}{Character vector of covariate names to include in model}

\item{random_var}{Name of random effect grouping variable (e.g., "patientID")}

\item{baseline_level}{Baseline timepoint level (default: "t0")}

\item{ref_level}{Reference level for diagnosis variable (default: "CONTROL")}

\item{non_ref_level}{Non-reference level for diagnosis variable (default: "CELIAC")}

\item{adjust_method}{Method for p-value adjustment (default: "BH" for Benjamini-Hochberg)}

\item{return_models}{Logical; if TRUE, return fitted model objects (warning: memory intensive)}

\item{verbose}{Logical; if TRUE, print progress messages}
}
\value{
A list with components:
\describe{
  \item{main_model}{Tibble with main model results (reference group + interactions)}
  \item{non_reference}{Tibble with non-reference group trajectory vs baseline}
  \item{between_group}{Tibble with between-group contrasts at each timepoint}
  \item{combined}{Tibble combining all results with harmonized columns}
  \item{n_features}{Number of features analyzed}
  \item{n_converged}{Number of models that converged successfully}
  \item{failed_features}{Feature IDs where models failed to converge}
}
}
\description{
Fits mixed-effects logistic regression models for each feature and extracts:
1. Main model terms (reference group trajectory + interactions)
2. Non-reference group trajectory (vs baseline)
3. Between-group contrasts at each timepoint
}
\examples{
\dontrun{
results <- fit_longitudinal_PA(
  PA_matrix = my_PA_data,
  metadata = my_metadata,
  dx_var = "Dx.Status",
  timepoint_var = "onset_timeline_combined",
  covariates = c("Country", "Sex", "Age"),
  random_var = "patientID"
)

# View significant results
results$combined \%>\% filter(p.adj < 0.05)
}
}
